<!DOCTYPE html>
<html>

<head>
  <title>Order Details</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.css">
</head>
<style>
  #order-container,
  h1 {
    margin-left: 300px;
    font-family: logo;
    color: rgb(53, 0, 48);
    font-size: 24px;
  }

  body {
    background-image: url(/asset/images/kl.png);
    background-size: cover;
  }

  @font-face {
    font-family: logo;
    src: url("/asset/fonts/Sobatyan-Regular.ttf");
  }

  .order-button {
    font-size: 25px;
    font-family: logo;
    margin-left: 300px;
    background-color: rgb(248, 219, 57);
  }

  #b1 {
    text-decoration: none;
    background-color: rgba(180, 236, 218, 0.849);
    font-size: 20px;
    padding: 10px;
    border-radius: 5px;
    color: #000;
    margin-bottom: 20px;
    display: inline-block;
    margin-left: 300px;
    font-family: logo;

  }
  #p1{
    font-size: 35px;
  }
</style>

<body>
  <a href="index.html" id="b1">Back</a>
  <h1>Order Details</h1>

  <div id="order-container"></div>

  <script src="https://cdn.jsdelivr.net/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.1/jquery.validate.min.js"></script>
  <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/additional-methods.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    $(document).ready(function () {
      // Fetch cake data from the JSON file
      $.getJSON('cakes.json', function (data) {
        var orderContainer = $('#order-container');
        var orders = data.order;
        var totalPrice = 0;

        // Render each order
        $.each(orders, function (orderIndex, order) {
          var orderItems = order.orderItems;

          var orderElement = $('<div class="order"></div>');

          // Render the order items
          $.each(orderItems, function (itemIndex, item) {
            var orderItem = $('<div class="item"></div>');
            orderItem.append('<img src="' + item.image + '" alt="' + item.name + '" id="sm" height="300px" width="300px">');
            orderItem.append('<h4>' + item.name + '</h4>');
            orderItem.append('<p>Price: ₹' + item.price + '</p>');
            orderElement.append(orderItem);

            totalPrice += item.price;
          });

          orderContainer.append(orderElement);
        });

        // Display the total price
        orderContainer.append('<p  id="p1">Total Price: ₹' + totalPrice + '</p>');
      });

      // Order button click event
      $(document).on('click', '.order-button', function () {
  Swal.fire({
    title: 'Order Cake',
    html:
      '<label for="payment-method">Payment Method:</label>' +
      '<select id="payment-method" class="swal2-input">' +
      '  <option value="UPI">UPI</option>' +
      '  <option value="Card">Credit/Debit Card</option>' +
      '  <option value="Cash">Cash</option>' +
      '</select><br>' +
      '<label for="cost">Cost:</label>' +
      '<input type="number" id="cost" class="swal2-input" placeholder="Enter Cost">' +
      '<label for="delivery-date">Delivery Date:</label>' +
      '<input type="date" id="delivery-date" class="swal2-input"><br>' +
      '<label for="message">Message:</label>' +
      '<input type="text" id="message" class="swal2-input" placeholder="Enter Message">' +
      '<label for="size">Size:</label>' +
      '<input type="text" id="size" class="swal2-input" placeholder="Enter Size"><br>' +
      '<label for="cake-name">Cake Name:</label>' +
      '<input type="text" id="cake-name" class="swal2-input" placeholder="Enter Cake Name">',
    focusConfirm: false,
    showCancelButton: true,
    cancelButtonColor:'#d33',
    preConfirm: function () {
      var paymentMethod = document.getElementById('payment-method').value;
      var cost = document.getElementById('cost').value;
      var deliveryDate = document.getElementById('delivery-date').value;
      var message = document.getElementById('message').value;
      var size = document.getElementById('size').value;
      var cakeName = document.getElementById('cake-name').value;

      // Validate input fields
      if (!paymentMethod || !cost || !deliveryDate || !message || !size || !cakeName) {
        Swal.showValidationMessage('Please fill in all fields');
      } else {
        return { paymentMethod: paymentMethod, cost: cost, deliveryDate: deliveryDate, message: message, size: size, cakeName: cakeName };
      }
    }
  }).then(function (result) {
    if (result.isConfirmed) {
      var paymentMethod = result.value.paymentMethod;
      var cost = result.value.cost;
      var deliveryDate = result.value.deliveryDate;
      var message = result.value.message;
      var size = result.value.size;
      var cakeName = result.value.cakeName;

      // Display the order details
      var orderDetails = 'Payment Method: ' + paymentMethod + '<br>' +
        'Cost: ₹' + cost + '<br>' +
        'Delivery Date: ' + deliveryDate + '<br>' +
        'Message: ' + message + '<br>' +
        'Size: ' + size + '<br>' +
        'Cake Name: ' + cakeName;

      Swal.fire(
        'Ordered!',
        'Your cake has been ordered successfully.<br>' + orderDetails,
        'success'
      );

      // Create an object with the form data
      var formData = {
        paymentMethod: paymentMethod,
        cost: cost,
        deliveryDate: deliveryDate,
        message: message,
        size: size,
        cakeName: cakeName
      };

      // Create a new XMLHttpRequest object
      var xhr = new XMLHttpRequest();

      // Set the request URL and method
      xhr.open('POST', 'http://localhost:3000/sales', true);

      // Set the request headers
      xhr.setRequestHeader('Content-Type', 'application/json');

      // Define the callback function to handle the response
      xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE) {
          if (xhr.status === 200) {
            console.log('Form data saved successfully');
          } else {
            console.error('Failed to save form data');
          }
        }
      };

      // Convert the form data to JSON string
      var jsonData = JSON.stringify(formData);

      // Send the request with the JSON data
      xhr.send(jsonData);
    }
  });
});
    });
  </script>
  <button class="order-button">Order</button>
</body>

</html>